<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products | GRANFO</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        /* Preloader critico per evitare flash iniziale */
        #preloader { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: #0e1713; z-index: 99999; opacity: 1; visibility: visible; transition: opacity 0.3s ease, visibility 0.3s ease; }
        #preloader.loaded { opacity: 0; visibility: hidden; pointer-events: none; }
        .preloader-icon { width: 120px; height: auto; animation: breathe 2s infinite ease-in-out; }
        @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.7; } }
    </style>
</head>
<body>
    <script>document.documentElement.style.visibility='hidden';</script>
    <div id="preloader">
        <img src="../images/brand/granfoluce-logo.png" alt="GRANFOLUCE" class="preloader-icon">
    </div>
    <script>
        const hidePreloader = () => {
            document.documentElement.style.visibility = 'visible';
            const preloader = document.getElementById('preloader');
            if (preloader && !preloader.classList.contains('loaded')) {
                preloader.classList.add('loaded');
            }
        };
        window.addEventListener('load', () => {
            requestAnimationFrame(() => {
                setTimeout(hidePreloader, 80);
            });
        });
        setTimeout(hidePreloader, 3000);
    </script>

    <nav class="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo"><img src="../images/brand/granfoluce-logo.png" alt="GRANFOLUCE" style="height: 50px;"></a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="catalogs.html">Catalogs</a></li>
                <li><a href="products.html" class="active">Products</a></li>
                <li><a href="aurum.html">Domus</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contacts.html">Contacts</a></li>
            </ul>
            <div class="nav-actions">
                <button class="icon-btn" onclick="toggleSearch()" aria-label="Search"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                <div class="lang-selector"><a href="../prodotti.html" class="lang-item">IT</a><a href="#" class="lang-item active">EN</a></div>
                <button class="menu-toggle" onclick="toggleMenu()" aria-label="Menu"><span></span><span></span><span></span></button>
            </div>
        </div>
        <div id="mobile-menu" class="mobile-menu">
            <a href="index.html">Home</a>
            <a href="catalogs.html">Catalogs</a>
            <a href="products.html">Products</a>
            <a href="aurum.html">Domus</a>
            <a href="projects.html">Projects</a>
            <a href="about.html">About</a>
            <a href="contacts.html">Contacts</a>
        </div>
    </nav>

    <div id="search-overlay" class="search-overlay">
        <button class="close-search" onclick="toggleSearch()">✕</button>
        <div class="search-container"><input type="text" placeholder="Search..." autofocus></div>
    </div>

    <header class="page-header">
        <div class="page-header-bg"><img src="../images/prodotti/copertina-prodotti.webp" alt="Products"></div>
        <div class="container page-title"><p class="breadcrumb"><a href="index.html">Home</a> / <span>Products</span></p><h1>The Collections</h1></div>
    </header>

   <section class="section-padding" id="catalog">
    <div class="container">
        
        <div style="display:flex; justify-content:center; margin-bottom:0.75rem;">
            <button id="wishlist-chip" class="chip" style="display:none;" onclick="document.getElementById('wishlist')?.scrollIntoView({ behavior: 'smooth' });">Go to Wishlist</button>
        </div>

        <div class="filters-bar">
            <div class="scroller-track">
                <button class="chip active" onclick="filterProducts('all', this)">All</button>
                <button class="chip" onclick="filterProducts('pendant', this)">Pendant</button>
                <button class="chip" onclick="filterProducts('table', this)">Table</button>
                <button class="chip" onclick="filterProducts('ceiling', this)">Ceiling</button>
                <button class="chip" onclick="filterProducts('wall', this)">Wall</button>
                <button class="chip" onclick="filterProducts('floor', this)">Floor</button>
                <button class="chip" onclick="filterProducts('vases & objects', this)">Vases & Objects</button>
                <button class="chip" onclick="filterProducts('outdoor', this)">Outdoor</button>
            </div>
            
        </div>

        <p class="results-count" id="results-count"></p>

        <div class="products-page-grid reveal" id="product-grid">
            
            <div class="product-item" data-category="pendant" data-price="low" data-material="metal" data-product-id="fungo-black" data-note="Note: Contact us for more info and variants.">
                <div class="wishlist-btn"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
                <img src="../images/prodotti/sospensione/fungonero.webp" alt="Fungo Black pendant" onclick="openLightbox(this.src)" style="cursor: pointer;">
                <div class="p-3">
                    <h3>Fungo Black</h3>
                    <p style="color:var(--color-text-muted); font-size:0.9rem;">Metal pendant</p>
                    <p style="color:var(--color-accent); font-weight:600; margin-top:0.5rem;">€ 240,00</p>
                    <button class="btn-share-native" onclick="shareProduct('Fungo Black', 'Metal pendant - GRANFO', window.location.href)"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>Share</button>
                </div>
            </div>

            <div class="product-item" data-category="pendant" data-price="medium" data-material="gold" data-product-id="luxe-table" data-note="Note: Contact us for more info and variants.">
                <div class="wishlist-btn"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
                <img src="../images/prodotti/Sospensione/barra.webp" alt="Barra pendant" onclick="openLightbox(this.src)" style="cursor: pointer;">
                <div class="p-3">
                    <h3>Luxe Table</h3>
                    <p style="color:var(--color-text-muted); font-size:0.9rem;">Gold finish pendant</p>
                    <p style="color:var(--color-accent); font-weight:600; margin-top:0.5rem;">€ 450,00</p>
                    <button class="btn-share-native" onclick="shareProduct('Luxe Table', 'Gold finish pendant - GRANFO', window.location.href)"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>Share</button>
                </div>
            </div>

             <div class="product-item" data-category="pendant" data-price="high" data-material="glass" data-product-id="applique-modern" data-note="Note: Contact us for more info and variants.">
                <div class="wishlist-btn"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
                <img src="../images/prodotti/sospensione/sospvetro.webp" alt="Glass pendant" onclick="openLightbox(this.src)" style="cursor: pointer;">
                <div class="p-3">
                    <h3>Applique Modern</h3>
                    <p style="color:var(--color-text-muted); font-size:0.9rem;">Geometric glass design</p>
                    <p style="color:var(--color-accent); font-weight:600; margin-top:0.5rem;">€ 180,00</p>
                    <button class="btn-share-native" onclick="shareProduct('Applique Modern', 'Geometric glass design - GRANFO', window.location.href)"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>Share</button>
                </div>
            </div>

            <div class="product-item" data-category="pendant" data-price="medium" data-material="metal" data-product-id="garden-light" data-note="Note: Contact us for more info and variants.">
                <div class="wishlist-btn"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
                <img src="../images/prodotti/sospensione/tubo.webp" alt="Tubo pendant" onclick="openLightbox(this.src)" style="cursor: pointer;">
                <div class="p-3">
                    <h3>Garden Light</h3>
                    <p style="color:var(--color-text-muted); font-size:0.9rem;">Water-resistant pendant</p>
                    <p style="color:var(--color-accent); font-weight:600; margin-top:0.5rem;">€ 320,00</p>
                    <button class="btn-share-native" onclick="shareProduct('Garden Light', 'Water-resistant pendant - GRANFO', window.location.href)"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>Share</button>
                </div>
            </div>

            </div>
    </div>
</section>

<div class="filter-overlay" id="filter-overlay" onclick="toggleFilters()"></div>
<div class="filter-sheet" id="filter-sheet">
    <div class="filter-header">
        <h3>Filter Products</h3>
        <button class="close-filter" onclick="toggleFilters()">✕</button>
    </div>
    <div class="filter-content">
        <div class="filter-group">
            <h4>Price</h4>
            <label><input type="checkbox" value="low" onchange="applyAdvancedFilters()"> €0 - €200</label>
            <label><input type="checkbox" value="medium" onchange="applyAdvancedFilters()"> €200 - €500</label>
            <label><input type="checkbox" value="high" onchange="applyAdvancedFilters()"> €500+</label>
        </div>
        <div class="filter-group">
            <h4>Material</h4>
            <label><input type="checkbox" value="glass" onchange="applyAdvancedFilters()"> Blown Glass</label>
            <label><input type="checkbox" value="metal" onchange="applyAdvancedFilters()"> Metal</label>
            <label><input type="checkbox" value="gold" onchange="applyAdvancedFilters()"> Gold Finish</label>
        </div>
    </div>
    <div class="filter-footer">
        <button class="btn btn-gold w-full" onclick="toggleFilters()">See Results</button>
    </div>
</div>

    <section class="section-padding" id="wishlist" style="display:none;">
        <div class="container">
            <div class="section-header">
                <div><span class="eyebrow">Favorites</span><h2>Your Wishlist</h2></div>
            </div>
            <div class="products-page-grid reveal" id="wishlist-grid"></div>
            <p class="results-count" id="wishlist-empty" style="margin-top:1rem;">No products in wishlist.</p>
        </div>
    </section>

   <footer class="footer">
        <div class="container footer-grid">
            <div class="footer-col brand-col">
                <a href="index.html" class="footer-logo"><img src="../images/brand/granfoluce-logo.png" alt="GRANFOLUCE" style="height: 60px;"></a>
                <p class="copyright">© 2025 GRANFO ILLUMINAZIONE S.N.C.<br>All Rights Reserved.</p>
                <div class="social-icons">
                    <a href="https://www.facebook.com/Granfoluce.lampadari/?locale=it_IT" aria-label="Facebook" target="_blank" rel="noopener noreferrer"><svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path></svg></a>
                    <a href="https://www.instagram.com/granfoluce/" aria-label="Instagram"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"></path></svg></a>
                    <a href="https://it.pinterest.com/granfolucefb/" aria-label="Pinterest"><svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.399.165-1.487-.69-2.435-2.844-2.435-4.576 0-3.719 2.703-7.149 7.808-7.149 4.105 0 7.292 2.925 7.292 6.829 0 4.075-2.57 7.356-6.138 7.356-1.2 0-2.324-.623-2.707-1.36l-.738 2.803c-.266 1.015-.99 2.278-1.477 3.05 1.11.343 2.296.529 3.518.529 6.618 0 11.996-5.383 11.996-12.004C24.013 5.367 18.636 0 12.017 0z"/></svg></a>
                    <a href="https://www.youtube.com/@granfoluce3774/shorts" aria-label="YouTube"><svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
                </div>
            </div>
            <div class="footer-col">
                <h4>MENU</h4>
                <ul>
                    <li><a href="about.html">About</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="contacts.html">Contact Us</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>INFO</h4>
                <div class="footer-text-group">
                    <p>GRANFO ILLUMINAZIONE S.N.C.</p>
                    <p>VAT 01410980237</p>
                    <a href="privacy-policy.html" class="privacy-link">Privacy Policy</a>
                </div>
            </div>
            <div class="footer-col">
                <h4>CONTACTS</h4>
                <div class="contact-rows">
                    <p><span class="label">Email:</span><br><a href="mailto:granfoluce@hotmail.it" class="highlight-link">granfoluce@hotmail.it</a></p>
                    <p><span class="label">Phone:</span><br><a href="tel:+39045528541" class="highlight-link">+39 045 528541</a></p>
                    <p><span class="label">Address:</span><br><a href="https://maps.google.com" target="_blank" class="highlight-link underline">via Ponte S. Pancrazio 8 Verona</a></p>
                </div>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/393385978768" class="whatsapp-float"><svg width="32" height="32" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.017-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg></a>
    <button id="backToTop" class="back-to-top">↑</button>

    <div id="cookie-banner" class="cookie-banner">
        <p>We use cookies to improve your experience.</p>
        <div class="cookie-buttons">
            <button id="acceptCookies" class="btn btn-gold btn-small">Accept</button>
            <button onclick="document.getElementById('cookie-banner').style.display='none'" class="btn-text">Close</button>
        </div>
    </div>

    <script>
        function toggleMenu() { document.getElementById('mobile-menu').classList.toggle('active'); document.body.classList.toggle('no-scroll'); }
        function toggleSearch() { const overlay = document.getElementById('search-overlay'); overlay.classList.toggle('active'); if(overlay.classList.contains('active')) setTimeout(() => overlay.querySelector('input').focus(), 100); }
        const revealElements = document.querySelectorAll('.reveal');
        const revealObserver = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('active'); } }); }, { threshold: 0.1 });
        revealElements.forEach(el => revealObserver.observe(el));
        /* --- FILTER LOGIC (EN) --- */
let activeCategory = 'all';
let activeSearchQuery = '';

function toggleFilters() {
    const sheet = document.getElementById('filter-sheet');
    const overlay = document.getElementById('filter-overlay');
    sheet.classList.toggle('active');
    overlay.classList.toggle('active');
    if(sheet.classList.contains('active')) document.body.style.overflow = 'hidden';
    else document.body.style.overflow = '';
}

function filterProducts(category, btnElement) {
    activeCategory = category;
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    if (btnElement) btnElement.classList.add('active');
    applyAdvancedFilters();
}

window.addEventListener('load', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get('category');
    const q = urlParams.get('q');
    if (category) {
        const btn = Array.from(document.querySelectorAll('.chip')).find(c => c.textContent.toLowerCase().includes(category.toLowerCase()) || c.getAttribute('onclick')?.includes(category));
        if (btn) filterProducts(category, btn);
    }
    if (q) {
        activeSearchQuery = q;
        const overlay = document.getElementById('search-overlay');
        const input = overlay ? overlay.querySelector('input') : null;
        if (input) input.value = q;
        applyAdvancedFilters();
    }
});

function applyAdvancedFilters() {
    const products = document.querySelectorAll('.product-item');
    let visibleCount = 0;

    const priceFilters = Array.from(document.querySelectorAll('input[type="checkbox"][value="low"]:checked, input[type="checkbox"][value="medium"]:checked, input[type="checkbox"][value="high"]:checked')).map(cb => cb.value);
    const materialFilters = Array.from(document.querySelectorAll('input[type="checkbox"][value="glass"]:checked, input[type="checkbox"][value="metal"]:checked, input[type="checkbox"][value="gold"]:checked')).map(cb => cb.value);

    const normalizedQuery = (activeSearchQuery || '').toLowerCase().trim();

    products.forEach(product => {
        const pCat = product.getAttribute('data-category');
        const pPrice = product.getAttribute('data-price');
        const pMat = product.getAttribute('data-material');
        const title = (product.querySelector('h3')?.textContent || '').toLowerCase();
        const alt = (product.querySelector('img')?.getAttribute('alt') || '').toLowerCase();

        const matchCat = (activeCategory === 'all' || activeCategory === pCat);
        const matchPrice = (priceFilters.length === 0 || priceFilters.includes(pPrice));
        const matchMat = (materialFilters.length === 0 || materialFilters.includes(pMat));
        const matchText = (normalizedQuery.length === 0) || (
            title.includes(normalizedQuery) ||
            pCat?.toLowerCase().includes(normalizedQuery) ||
            pMat?.toLowerCase().includes(normalizedQuery) ||
            alt.includes(normalizedQuery)
        );

        if (matchCat && matchPrice && matchMat && matchText) {
            product.style.display = 'block';
            visibleCount++;
            product.style.opacity = '0';
            setTimeout(() => product.style.opacity = '1', 50);
        } else {
            product.style.display = 'none';
        }
    });

    const countText = document.getElementById('results-count');
    if (visibleCount === 0) countText.innerText = "No products found.";
    else countText.innerText = `Showing ${visibleCount} products`;
}

(function initSearchLive(){
    const overlay = document.getElementById('search-overlay');
    const input = overlay ? overlay.querySelector('input') : null;
    if (!input) return;
    input.addEventListener('input', (e) => {
        activeSearchQuery = e.target.value || '';
        applyAdvancedFilters();
    });
    input.addEventListener('keydown', (e) => { if (e.key === 'Escape') toggleSearch(); });
})();

// === WISHLIST FUNCTIONALITY ===
const productTemplateMap = {};
function buildProductTemplateMap() { document.querySelectorAll('.product-item').forEach(item => { const id = item.getAttribute('data-product-id'); if (id && !productTemplateMap[id]) productTemplateMap[id] = item; }); }
function getWishlist() { const wishlist = localStorage.getItem('granfoluce_wishlist'); return wishlist ? JSON.parse(wishlist) : []; }
function saveWishlist(wishlist) { localStorage.setItem('granfoluce_wishlist', JSON.stringify(wishlist)); }
function toggleWishlist(productId, btnElement) { let wishlist = getWishlist(); const index = wishlist.indexOf(productId); if (index > -1) { wishlist.splice(index, 1); btnElement.classList.remove('active'); } else { wishlist.push(productId); btnElement.classList.add('active'); } saveWishlist(wishlist); renderWishlist(); }
function bindWishlistButton(btn) { if (btn.dataset.bound === 'true') return; const productItem = btn.closest('.product-item'); const productId = productItem.getAttribute('data-product-id'); const wishlist = getWishlist(); if (wishlist.includes(productId)) btn.classList.add('active'); btn.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); toggleWishlist(productId, btn); }); btn.dataset.bound = 'true'; }
function initWishlist() { const wishlistBtns = document.querySelectorAll('.wishlist-btn'); wishlistBtns.forEach(bindWishlistButton); }
function renderWishlist() { const section = document.getElementById('wishlist'); const grid = document.getElementById('wishlist-grid'); const empty = document.getElementById('wishlist-empty'); if (!section || !grid || !empty) return; const wishlist = getWishlist(); grid.innerHTML = ''; const wishlistChip = document.getElementById('wishlist-chip'); if (wishlist.length === 0) { section.style.display = 'none'; if (wishlistChip) wishlistChip.style.display = 'none'; return; } section.style.display = 'block'; empty.style.display = 'none'; if (wishlistChip) wishlistChip.style.display = 'inline-block'; wishlist.forEach(id => { const template = productTemplateMap[id]; if (!template) return; const clone = template.cloneNode(true); clone.style.display = 'block'; const btn = clone.querySelector('.wishlist-btn'); if (btn) { btn.classList.add('active'); bindWishlistButton(btn); } grid.appendChild(clone); }); }

window.addEventListener('DOMContentLoaded', () => { buildProductTemplateMap(); initWishlist(); renderWishlist(); applyAdvancedFilters(); });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const activeDesktop = document.querySelector('.nav-links a.active');
            if (!activeDesktop) return;
            const targetHref = activeDesktop.getAttribute('href');
            document.querySelectorAll('.mobile-menu a').forEach(link => {
                if (link.getAttribute('href') === targetHref) link.classList.add('active');
            });
        });

        // Image error fallback handler
        document.addEventListener('error', function(e) {
            if (e.target.tagName && e.target.tagName.toLowerCase() === 'img') {
                e.target.src = '../images/placeholder.png';
                e.target.alt = 'Image not available';
            }
        }, true);
    
    // Native Share API function
    async function shareProduct(title, text, url) {
        if (navigator.share) {
            try {
                await navigator.share({ title: title, text: text, url: url });
            } catch (err) {
                if (err.name !== 'AbortError') {
                    console.error('Share failed:', err);
                }
            }
        } else {
            // Fallback: copy to clipboard
            try {
                await navigator.clipboard.writeText(`${title} - ${text} - ${url}`);
                alert('Link copied to clipboard!');
            } catch (err) {
                console.error('Clipboard failed:', err);
            }
        }
    }

    // Lightbox with caption
    function openLightbox(elOrSrc) {
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const caption = document.getElementById('lightbox-caption');
        const note = document.getElementById('lightbox-note');

        let src = '', title = '', desc = '';
        if (typeof elOrSrc === 'string') {
            src = elOrSrc;
            const imgEl = Array.from(document.querySelectorAll('img')).find(i => (i.currentSrc && i.currentSrc.includes(src)) || i.src.includes(src) || i.getAttribute('src') === src);
            const item = imgEl ? imgEl.closest('.product-item') : null;
            title = item?.querySelector('h3')?.textContent || '';
            desc = item?.querySelector('.p-3 p')?.textContent || imgEl?.alt || '';
        } else {
            const imgEl = elOrSrc;
            src = imgEl.src;
            const item = imgEl.closest('.product-item');
            title = item?.querySelector('h3')?.textContent || '';
            const ps = item ? item.querySelectorAll('.p-3 p') : [];
            desc = ps.length ? ps[0].textContent : imgEl.alt || '';
        }

        lightboxImg.src = src;
        if (caption) caption.innerHTML = (title ? `<strong>${title}</strong>` : '') + (desc ? `<br>${desc}` : '');
        const item = (typeof elOrSrc === 'string')
            ? Array.from(document.querySelectorAll('img')).find(i => (i.currentSrc && i.currentSrc.includes(src)) || i.src.includes(src) || i.getAttribute('src') === src)?.closest('.product-item')
            : elOrSrc.closest('.product-item');
        const noteText = item?.getAttribute('data-note') || '';
        if (note) {
            note.innerHTML = noteText;
            note.style.display = noteText ? 'block' : 'none';
        }
        document.body.style.overflow = 'hidden';
        lightbox.style.display = 'flex';
    }
    function closeLightbox() {
        const lightbox = document.getElementById('lightbox');
        lightbox.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    </script>

    <!-- Lightbox Overlay -->
    <div id="lightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:99999; justify-content:center; align-items:center;" onclick="closeLightbox()">
        <div class="lightbox-inner" style="display:flex; flex-direction:column; align-items:center;" onclick="event.stopPropagation()">
            <img id="lightbox-img" src="" style="max-width:90%; max-height:80%; object-fit:contain;">
            <div class="lightbox-caption" id="lightbox-caption" style="max-width:90%; margin:1rem auto 0; color:#fff; font-size:0.95rem; line-height:1.4; text-align:center;"></div>
            <div id="lightbox-note" class="lightbox-note" style="width:90%; margin:0.5rem auto 0; color:#fff; opacity:0.9; font-size:0.9rem; line-height:1.5; text-align:center; display:none;"></div>
        </div>
    </div>

    <div class="store-bar">
        <a href="index.html" class="store-btn">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            Home
        </a>
        <a href="products.html" class="store-btn">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16"></path></svg>
            Products
        </a>
        <a href="products.html#wishlist" class="store-btn highlight">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
            Wishlist
        </a>
        <a href="https://wa.me/393385978768" class="store-btn">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
            WhatsApp
        </a>
    </div>
    <script>
        const hidePreloader = () => {
            const preloader = document.getElementById('preloader');
            if (preloader && !preloader.classList.contains('loaded')) {
                preloader.classList.add('loaded');
            }
        };
        window.addEventListener('load', () => {
            requestAnimationFrame(() => {
                setTimeout(hidePreloader, 80);
            });
        });
    </script>
    <script src="../nav-behavior.js"></script>
</body>
</html>
